# Requirements Document: EDINET Stock Screener

## 1. プロジェクト概要

### 1.1 目的

金融庁の EDINET API を活用し、有価証券報告書から財務データを取得・分析して割安株を発見する Python ベースのスクリーニングツール

### 1.2 主要機能

- 有価証券報告書の自動取得・解析
- 財務指標の自動計算
- 多様なスクリーニング条件によるフィルタリング
- 時系列分析・業界比較
- 結果の可視化・エクスポート

## 2. 機能要件

### 2.1 データ取得機能

- **EDINET API 連携**

  - API 認証・接続
  - 有価証券報告書一覧の取得
  - XBRL ファイルのダウンロード・解析
  - CSV ファイル形式でのデータ取得（2024 年 4 月対応）
  - エラーハンドリング・リトライ機能

- **対象データ**
  - 貸借対照表（BS）
  - 損益計算書（PL）
  - キャッシュフロー計算書（CF）
  - 株式関連情報

### 2.2 財務分析機能

- **基本指標計算**

  - PER（株価収益率）
  - PBR（株価純資産倍率）
  - PSR（株価売上高倍率）
  - PCFR（株価キャッシュフロー倍率）
  - ROE（自己資本利益率）
  - ROA（総資産利益率）
  - 自己資本比率
  - 流動比率

- **成長性指標**

  - 売上成長率（1 年、3 年、5 年）
  - 利益成長率（営業利益、当期純利益）
  - ROE 推移分析

- **独自スコアリング**
  - 総合割安度スコア
  - 財務健全性スコア
  - 成長性スコア

### 2.3 スクリーニング機能

- **事前定義済みスクリーン**

  - バリュー投資向け
  - グロース投資向け
  - 高配当株向け
  - 財務優良株向け

- **カスタムスクリーン**
  - 任意の指標による条件設定
  - 複数条件の組み合わせ
  - 条件の保存・読み込み

### 2.4 比較・分析機能

- **業界比較**

  - 同業他社との相対評価
  - 業界平均との比較
  - 業界内ランキング

- **時系列分析**
  - 財務指標の推移グラフ
  - トレンド分析
  - 前年同期比較

### 2.5 出力・可視化機能

- **結果出力**

  - CSV 形式でのエクスポート
  - Excel 形式でのエクスポート
  - PDF 形式でのレポート生成

- **可視化**
  - スクリーニング結果一覧
  - 財務指標チャート
  - 業界比較グラフ

## 3. 非機能要件

### 3.1 パフォーマンス

- API 呼び出し頻度制限の遵守
- 大量データ処理の効率化
- キャッシュ機能による高速化

### 3.2 可用性・信頼性

- ネットワーク障害時の自動リトライ
- データ整合性チェック
- ログ機能・エラー追跡

### 3.3 保守性

- モジュラー設計
- 設定ファイルによる外部化
- 単体テスト・統合テスト

## 4. 技術要件

### 4.1 開発環境

- **Python**: 3.12
- **パッケージ管理**: uv
- 必要ライブラリ
  - **API・データ取得**: requests, yfinance
  - **データ処理**: pandas, numpy
  - **XML/XBRL 解析**: lxml, beautifulsoup4
  - **データベース**: sqlite3（標準ライブラリ）
  - **出力**: csv（標準ライブラリ）
  - **設定管理**: configparser, python-dotenv
  - **ログ**: logging（標準ライブラリ）
  - **テスト**: pytest

### 4.2 外部 API

- EDINET API v2
- API キー管理

## 5. 未確定事項・質問事項

### 5.1 データ範囲について ✅ 確定

- **対象企業**: 全上場企業
- **過去データ期間**: 直近 1 年分（Phase 1）、将来的に 10 年分まで拡張
- **更新頻度**: ツール実行時にリアルタイム取得

### 5.2 株価データについて ✅ 確定

- **株価データ源**: yfinance ライブラリ使用（無料）

### 5.3 ユーザーインターフェース ✅ 確定

- **UI 形式**: コマンドライン（MVP 版）
- 将来的には Web UI 等を検討

### 5.4 設定・カスタマイズ

- **スクリーニング条件**: どの程度の詳細設定を可能にするか？
- **業界分類**: どの分類体系を使用するか（東証 33 業種、GICS 等）？

### 5.5 データ保存 ✅ 確定

- **ローカル DB**: SQLite 使用
- **テーブル設計**: EDINET API の実際の応答データ調査後に決定
- **キャッシュ戦略**: 取得済みデータの差分更新機能

### 5.6 ライセンス・利用規約

- **データ利用規約**: EDINET データの商用利用・再配布の制限確認
- **オープンソース化**: MIT、Apache 等のライセンス選択

## 6. 開発フェーズ案

### Phase 1: MVP（最小実用版）✅ 確定スコープ

**目標**: データ収集 → 財務指標計算 → 結果出力のパイプライン構築

- **データ取得**

  - EDINET API 接続・認証
  - 全上場企業の有価証券報告書取得（直近 1 年分）
  - yfinance ライブラリによる株価データ取得
  - SQLite データベースでの永続化
  - データ統合・整合性チェック

- **財務指標計算**

  - 基本指標: PER, PBR, PSR, ROE, ROA, 自己資本比率
  - 成長性指標: 前年同期比成長率

- **出力機能**
  - コマンドライン結果表示
  - CSV 形式でのエクスポート
  - 基本的なエラーハンドリング

**成果物**:

- SQLite データベース（edinet_screener.db）
- 企業財務データ一覧 CSV
- 計算済み財務指標一覧 CSV

### Phase 2: 機能拡張（将来）

- 過去 10 年分データ対応
- 時系列分析機能
- 高度なスクリーニング機能
- Web UI 実装

### Phase 2: 機能拡張

- Web UI 実装
- 高度なスクリーニング機能
- 可視化機能

### Phase 3: 高度化

- 業界比較・時系列分析
- 機械学習による予測機能
- パフォーマンス最適化
